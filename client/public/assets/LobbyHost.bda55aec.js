var Q=Object.defineProperty;var X=(l,s,e)=>s in l?Q(l,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[s]=e;var H=(l,s,e)=>(X(l,typeof s!="symbol"?s+"":s,e),e);import{S as Y,i as Z,s as x,e as w,a as v,c as F,b as E,d as k,m as D,g as $,t as S,f as ee,h as G,j as C,k as R,l as te,n as re,q as P,P as ne,r as le,I as se,_ as oe,z as L,u as q,G as ie,v as j,w as ae,x as ue,y as ce,A as fe,B as _}from"./index.7dfcd9fb.js";import{C as M,c as g,f as de,i as V,R as me,a as he,b as ye}from"./Card.97ea3429.js";import{G as pe,W as ke,L as Ce}from"./Game.cb56fc56.js";function _e(l,s){const e=s.selectedColor;let r=g[10].numeric;for(let t=0;t<5;t++)if(l[r+t][M[e]]===0)return!1;return!0}function ge(l,s){const e=s.selectedColor;let r=g[s.startingCard].numeric;for(let t=0;t<5;t++)if(l[r+t][M[e]]===0)return!1;return!0}function be(l,s){const e=s.selectedColor;let r=0,t=["2","3","4","5","6","7","8","9","10","j","q","k","a"];for(let n=0;n<t.length;n++){let o=g[t[n]].numeric;r+=l[o][M[e]]}return r>=5}function Ie(l,s){let e=g[s.primaryCard].numeric;if(!l[e])return!1;let r=0;for(let t=1;t<=4;t++)r+=l[e][t];return r==4}function Pe(l,s){let e=g[s.primaryCard].numeric;if(!l[e])return!1;let r=g[s.secondaryCard].numeric;if(!l[r])return!1;let t=[0,0];for(let n of[e,r])for(let o=1;o<=4;o++){let c=n===e?0:1;t[c]+=l[n][o]}return t[0]>=3&&t[1]>=2}function we(l,s){let e=g[s.startingCard].numeric,r=0;for(let t=0;t<5;t++){if(!l[e+t])return!1;for(let n=1;n<=4;n++)if(l[e+t][n]==1){r++;break}}return r==5}function ve(l,s){let e=g[s.primaryCard].numeric;if(!l[e])return!1;let r=0;for(let t=1;t<=4;t++)r+=l[e][t];return r>=3}function Se(l,s){let e=g[s.primaryCard].numeric;if(!l[e])return!1;let r=g[s.secondaryCard].numeric;if(!l[r])return!1;let t=[0,0];for(let n of[e,r])for(let o=1;o<=4;o++){let c=n===e?0:1;t[c]+=l[n][o]}return t[0]>=2&&t[1]>=2}function Ge(l,s){let e=g[s.primaryCard].numeric;if(!l[e])return!1;let r=0;for(let t=1;t<=4;t++)r+=l[e][t];return r>=2}function Te(l,s){let e=g[s.primaryCard].numeric;if(!l[e])return!1;let r=0;for(let t=1;t<=4;t++)r+=l[e][t];return r>=1}const Ne={royal:_e,flush:ge,color:be,four:Ie,full:Pe,street:we,three:ve,double:Se,pair:Ge,one:Te};let W=[];for(let l in me)if(isNaN(Number(l)))for(let s in he)isNaN(Number(s))&&W.push([l,s]);const O=W;class Be extends pe{constructor(e,r,t,n){super(e,r,t);H(this,"hands");H(this,"deck");H(this,"isFinished",!1);H(this,"cardCounts");this.hands=new Map(Object.entries(r.newHands)),this.deck=O.slice(),this.cardCounts=n}drawCards(e){if(e>5)throw"Drawing more than 5 cards is not a possibility";if(e>this.deck.length)throw"Not enough cards in deck to draw cards";let r=[];for(;r.length<e;){let t=Math.floor(Math.random()*this.deck.length),n=this.deck.splice(t,1)[0];r.push(n),this.cardCounts[de[n[0]].numeric][M[n[1]]]+=1}return r}shuffleDeck(){this.deck=O.slice()}dealCards(){this.cardCounts=V(),this.shuffleDeck(),this.hands=new Map,this.players.forEach(e=>{this.hands.set(e.uid,this.drawCards(5))})}check(e){if(!this.previousBet)throw"There is no bet";if(!Ne[this.previousBet.selectedRanking](this.cardCounts,this.previousBet)){const t=(this.currentPlayerIndx-1+this.playerCount)%this.playerCount;this.currentPlayerIndx=t,this.currentPlayer=this.players[this.currentPlayerIndx].uid}this.players[this.currentPlayerIndx].loses+=1,this.players[this.currentPlayerIndx].loses==2&&(this.eliminatedPlayers.push(this.players[this.currentPlayerIndx]),this.players.splice(this.currentPlayerIndx,1),this.playerCount-=1,this.currentPlayerIndx=this.currentPlayerIndx-1,this.currentPlayerIndx<0&&(this.currentPlayerIndx=this.players.length-1),this.currentPlayer=this.players[this.currentPlayerIndx].uid),this.previousBet=null}validateCheck(){this.check(),this.dealCards();let e=this.hands.get(this.thisPlayerId);return e&&(this.hand=e),{newHands:Object.fromEntries(this.hands),players:this.players,roundStartingPlayerId:this.currentPlayer,eliminatedPlayers:this.eliminatedPlayers}}getCardCount(){return this.cardCounts}}function U(l){l[17]=l[18].default}function He(l){let s,e,r,t,n,o,c,d,I,a,f,y,b,m=l[1]&&A(l);return n=new Ce({props:{players:l[0],thisPlayerId:l[3]}}),{c(){s=w("div"),m&&m.c(),e=v(),r=w("br"),t=v(),F(n.$$.fragment),o=v(),c=w("div"),d=w("button"),d.textContent="Start Game",I=v(),a=w("button"),a.textContent="Close Game",E(s,"class","container group kod svelte-1o27nbz"),E(c,"class","container")},m(u,p){k(u,s,p),m&&m.m(s,null),k(u,e,p),k(u,r,p),k(u,t,p),D(n,u,p),k(u,o,p),k(u,c,p),L(c,d),L(c,I),L(c,a),f=!0,y||(b=[q(d,"click",l[8]),q(a,"click",l[9])],y=!0)},p(u,p){u[1]?m?m.p(u,p):(m=A(u),m.c(),m.m(s,null)):m&&(m.d(1),m=null);const T={};p&1&&(T.players=u[0]),p&8&&(T.thisPlayerId=u[3]),n.$set(T)},i(u){f||(G(n.$$.fragment,u),f=!0)},o(u){S(n.$$.fragment,u),f=!1},d(u){u&&C(s),m&&m.d(),u&&C(e),u&&C(r),u&&C(t),R(n,u),u&&C(o),u&&C(c),y=!1,ie(b)}}}function Le(l){let s,e,r,t={ctx:l,current:null,token:null,hasCatch:!1,pending:Fe,then:Ee,catch:Me,value:18,blocks:[,,,]};return j(e=l[4],t),{c(){s=ae(),t.block.c()},m(n,o){k(n,s,o),t.block.m(n,t.anchor=o),t.mount=()=>s.parentNode,t.anchor=s,r=!0},p(n,o){l=n,t.ctx=l,o&16&&e!==(e=l[4])&&j(e,t)||ue(t,l,o)},i(n){r||(G(t.block),r=!0)},o(n){for(let o=0;o<3;o+=1){const c=t.blocks[o];S(c)}r=!1},d(n){n&&C(s),t.block.d(n),t.token=null,t=null}}}function A(l){let s,e,r,t;return{c(){s=w("div"),s.textContent="game code:",e=v(),r=w("div"),t=ce(l[1])},m(n,o){k(n,s,o),k(n,e,o),k(n,r,o),L(r,t)},p(n,o){o&2&&fe(t,n[1])},d(n){n&&C(s),n&&C(e),n&&C(r)}}}function Me(l){return{c:_,m:_,p:_,i:_,o:_,d:_}}function Ee(l){U(l);let s,e;return s=new l[17]({props:{gameId:l[1],socket:l[2],thisPlayerId:l[3],isHost:!0,kickPlayer:l[10],game:l[7],closeGame:l[9]}}),s.$on("leave",l[9]),s.$on("gameFinished",l[11]),{c(){F(s.$$.fragment)},m(r,t){D(s,r,t),e=!0},p(r,t){U(r);const n={};t&2&&(n.gameId=r[1]),t&4&&(n.socket=r[2]),t&8&&(n.thisPlayerId=r[3]),t&128&&(n.game=r[7]),s.$set(n)},i(r){e||(G(s.$$.fragment,r),e=!0)},o(r){S(s.$$.fragment,r),e=!1},d(r){R(s,r)}}}function Fe(l){return{c:_,m:_,p:_,i:_,o:_,d:_}}function De(l){let s,e,r,t,n,o;const c=[Le,He],d=[];function I(a,f){return a[4]?0:1}return e=I(l),r=d[e]=c[e](l),n=new ke({props:{showModal:l[5],winnerUsername:l[6],close:l[12]}}),{c(){s=w("div"),r.c(),t=v(),F(n.$$.fragment),E(s,"class","container")},m(a,f){k(a,s,f),d[e].m(s,null),k(a,t,f),D(n,a,f),o=!0},p(a,[f]){let y=e;e=I(a),e===y?d[e].p(a,f):($(),S(d[y],1,1,()=>{d[y]=null}),ee(),r=d[e],r?r.p(a,f):(r=d[e]=c[e](a),r.c()),G(r,1),r.m(s,null));const b={};f&32&&(b.showModal=a[5]),f&64&&(b.winnerUsername=a[6]),f&48&&(b.close=a[12]),n.$set(b)},i(a){o||(G(r),G(n.$$.fragment,a),o=!0)},o(a){S(r),S(n.$$.fragment,a),o=!1},d(a){a&&C(s),d[e].d(),a&&C(t),R(n,a)}}}function Re(l,s,e){let{gameId:r}=s,{socket:t}=s,{players:n=[]}=s,{thisPlayerId:o}=s,c,d,I=!1,a="",f,y=1,b=V();const m=te();re(()=>{t.on(P.newPlayerJoined,i=>{if(console.log("Join event",i.username),!i)throw"No data from server";y++;let h=new ne(i.uid,i.username);h.isOnline=i.isOnline,e(0,n=[...n,h])}),t.on(le.reconnectToGame,i=>{console.log("request here ",i);let h=n.find(B=>B.uid===i.requesterUid),N={didReconnect:Boolean(h),reconnectRequest:i};if(h){let B={players:n,thisPlayerId:h.uid,thisPlayerName:h.username,gameStarted:!1};if(c){let z=f.hands.get(h.uid);if(!z){console.log("Couldnt find cards for reconnecting player");return}if(B.gameStarted=!0,!f.previousBet)throw"There should be a previous bet!?";B.startedGameInfo={currentBet:f.previousBet,currentPlayer:f.currentPlayer,newHand:z}}N.gameInfo=B}console.log("response to request ",N),t.emit(se.reconnectToGame,N)}),t.on(P.playerLeftGame,i=>{if(console.log("player disconnected",i.uid),!!i)if(c){let h=n.find(N=>N.uid===i.uid);h&&(h.isOnline=!1),e(0,n),console.log(n)}else e(0,n=n.filter(h=>h.uid!==i.uid)),e(0,n),y--}),t.on(P.gameStarted,i=>{i&&(d=i,e(7,f=new Be(n,d,o,b)),e(7,f.gameClosed=!1,f),e(4,c=oe(()=>import("./GameView.310342a8.js"),["assets/GameView.310342a8.js","assets/index.7dfcd9fb.js","assets/index.49f28f53.css","assets/Card.97ea3429.js","assets/GameView.1b0781ce.css"])))}),t.on(P.playerReady,i=>{console.log("this player ready here!"),y++}),t.on(P.gameClosed,()=>{m("gameClosed")})});function u(){if(n.length>=2&&n.length<=5&&y==n.length){let i=ye(n);b=i.cardCounts;let h=i.payload;t.emit(P.gameStarted,h)}else throw console.log(y),"Invalid amount of players to start the game or not everyone is ready"}function p(){console.warn("THIS SHIT IS CALLED"),t.emit(P.gameClosed,{gameId:r}),e(4,c=void 0),e(0,n=[])}function T(i){t.emit(P.kickPlayer,i)}function J(i){y=1,i.detail&&i.detail.username&&(e(6,a=i.detail.username),e(5,I=!0)),e(4,c=void 0)}const K=()=>{e(5,I=!1),e(4,c=void 0)};return l.$$set=i=>{"gameId"in i&&e(1,r=i.gameId),"socket"in i&&e(2,t=i.socket),"players"in i&&e(0,n=i.players),"thisPlayerId"in i&&e(3,o=i.thisPlayerId)},[n,r,t,o,c,I,a,f,u,p,T,J,K]}class Ue extends Y{constructor(s){super(),Z(this,s,Re,De,x,{gameId:1,socket:2,players:0,thisPlayerId:3})}}export{Ue as default};
